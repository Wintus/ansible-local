---

# hub command

- name: check hub installed
  shell: which hub
  register: which_hub
  failed_when: no
  changed_when: which_hub.rc != 0

- name: check hub version
  shell: hub --version
  register: hub_ver
  failed_when: no
  changed_when: "'hub version ' + hub_version not in hub_ver.stdout"

- name: install or update hub
  when: which_hub is changed or hub_ver is changed
  vars:
    working_dir: /tmp
  block:
    - name: download hub binary
      unarchive:
        remote_src: yes
        src: "{{ hub_url }}"
        dest: "{{ working_dir }}"

    - name: install hub with man
      shell: ./install
      args:
        chdir: "{{ working_dir }}/hub-linux-amd64-{{ hub_version }}/bin/hub"
      become: yes

    - name: add fish completions
      copy:
        src: "{{ working_dir }}/hub-linux-amd64-{{ hub_version }}/etc/hub.fish_completion"
        dest: ~/.config/fish/completions/hub.fish

    - name: set hub profile
      copy:
        src: hub.sh
        dest: "{{ bash_profile_dir }}"
        mode: a+x
