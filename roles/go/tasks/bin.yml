---

# hub command

- name: check hub installed
  shell: which hub
  register: which_hub
  failed_when: no
  changed_when: which_hub.rc != 0

- name: check hub version
  shell: hub --version
  register: hub_v
  failed_when: no
  changed_when: hub_v.stdout | regex_search('\bhub version ([.\d])+\b')
    is not version(hub_version)

- name: install or update hub
  when: which_hub is changed or hub_v is changed
  block:
  - name: download hub binary
    unarchive:
      remote_src: yes
      src: "{{ hub_url }}"
      dest: /tmp

  - name: install hub binary
    copy:
      src: "/tmp/hub-linux-amd64-{{ hub_version }}/bin/hub"
      dest: /usr/local/bin
      mode: a+x
    become: yes

- name: set hub profile
  copy:
    src: hub.sh
    dest: "{{ bash_profile_dir }}"
    mode: a+x

# ghq command

- name: check ghq installed
  shell: which ghq
  register: which_ghq
  changed_when: which_ghq.rc != 0
  failed_when: no

- name: install ghq
  shell: go get github.com/motemen/ghq
  when: which_ghq.rc != 0
